<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—ñ–¥–±–æ—Ä—É —à–∏–Ω —ñ –¥–∏—Å–∫—ñ–≤</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 10px; background-color: #f4f4f9; color: #333; }
        .container { max-width: 1200px; margin: 10px auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        h1 { color: #0056b3; text-align: center; margin-bottom: 15px; font-size: 1.5em; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ–ª—ñ–≤ –≤–≤–æ–¥—É */
        .input-group { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .input-item { flex: 1 1 100%; min-width: 120px; }
        @media (min-width: 768px) {
            .input-item { flex: 1 1 0; }
        }
        label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; font-size: 0.9em; }
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1em;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        button { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1em; font-weight: 600; transition: background-color 0.3s; margin-top: 10px; }
        button:hover { background-color: #0056b3; }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç–æ–∫ */
        .card-container { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; justify-content: space-around; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–∞—Ä—Ç–∫–∏ */
        .result-card {
            flex: 1 1 100%;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            background-color: #f9f9f9;
            transition: transform 0.2s;
            min-width: 250px;
        }
        .result-card:hover {
            transform: translateY(-3px);
        }

        @media (min-width: 768px) {
            .result-card {
                flex: 1 1 calc(25% - 20px);
            }
            .card-initial {
                flex: 1 1 calc(100% / 5);
            }
        }

        .card-title { font-size: 1.1em; font-weight: 700; margin-bottom: 10px; text-align: center; color: #0056b3; }
        .card-body p { margin: 5px 0; font-size: 0.95em; }
        .card-body span { font-weight: 600; color: #555; }

        /* –°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –Ω–∞–π–∫—Ä–∞—â–æ–≥–æ –≤–∞—Ä—ñ–∞–Ω—Ç—É */
        .best-option-card { border: 3px solid #28a745; background-color: #e6ffed; }
        .alternative-option-card { border: 3px solid #ffc107; background-color: #fff8e1; }

        .big-size { font-size: 1.4em; font-weight: 800; color: #28a745; margin: 10px 0; display: block; }
        .delta-good { color: #28a745; }
        .delta-warn { color: #dc3545; }
        .error { color: #dc3545; font-weight: 600; margin-top: 10px; }
        .info-block { padding: 10px; border-radius: 6px; background-color: #e9ecef; margin-bottom: 20px; font-size: 0.9em; }
        .limit-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .limit-table th, .limit-table td { border: 1px solid #ccc; padding: 5px; text-align: center; }
        .limit-table th { background-color: #d8dbdf; }
    </style>
</head>
<body>

<div class="container">
    <h1>üöó –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—ñ–¥–±–æ—Ä—É —à–∏–Ω —ñ –¥–∏—Å–∫—ñ–≤</h1>
    <!-- Hidden element to mark CSS selectors as used for IDE analyzer -->
    <div class="best-option-card alternative-option-card delta-good delta-warn" style="display:none"></div>
    <p>–í–≤–µ–¥—ñ—Ç—å –ø–æ—Ç–æ—á–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —à–∏–Ω–∏.</p>
    <div class="info-block">
        <p><strong>–£–º–æ–≤–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É:</strong> **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–æ–∂–ª–∏–≤–∏–π –¥–∏—Å–∫** –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—é –¥–µ–ª—å—Ç–æ—é. **–û–±–º–µ–∂–µ–Ω–Ω—è –¥–µ–ª—å—Ç–∏: –Ω–µ –±—ñ–ª—å—à–µ &pm;2%**. –ü—Ä–æ—Ñ—ñ–ª—å &ge; 20% –∑ –∫—Ä–æ–∫–æ–º 5%. –î—ñ–∞–º–µ—Ç—Ä –¥–∏—Å–∫–∞ &le; 25 –¥—é–π–º—ñ–≤ (—Ü—ñ–ª–µ —á–∏—Å–ª–æ).</p>
        <p>–í–∞—Ä—ñ–∞–Ω—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É: –û—Å–Ω–æ–≤–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ W, W+10, W+20 –º–º. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç (–∫—Ä–æ–∫ 10 –º–º) –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è, —è–∫—â–æ —ñ—Å–Ω—É—î —ñ–Ω—à–∞ —à–∏—Ä–∏–Ω–∞ (W &lt; W –∞–±–æ W > W+20), —è–∫–∞ –¥–∞—î –º–µ–Ω—à—É –∞–±—Å–æ–ª—é—Ç–Ω—É –¥–µ–ª—å—Ç—É –¥—ñ–∞–º–µ—Ç—Ä–∞.</p>
        <p><strong>(W ‚Äî —Ü–µ –®–∏—Ä–∏–Ω–∞ —à–∏–Ω–∏ –≤ –º–º). –£–í–ê–ì–ê:</strong> –ó–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è **–º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ —Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ñ** –ª—ñ–º—ñ—Ç–∏ —à–∏—Ä–∏–Ω–∏ —Ç–∞ –ø—Ä–æ—Ñ—ñ–ª—é –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –¥—ñ–∞–º–µ—Ç—Ä–∞ –¥–∏—Å–∫–∞.</p>

        <details>
            <summary><strong>–ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ —Ç–∞ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ñ –ª—ñ–º—ñ—Ç–∏ (–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É)</strong></summary>
            <table class="limit-table">
                <thead>
                <tr>
                    <th rowspan="2">R (–¥—é–π–º–∏)</th>
                    <th colspan="2">–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –ª—ñ–º—ñ—Ç</th>
                    <th colspan="2">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –ª—ñ–º—ñ—Ç</th>
                </tr>
                <tr>
                    <th>W (–º–º)</th>
                    <th>V (%)</th>
                    <th>W (–º–º)</th>
                    <th>V (%)</th>
                </tr>
                </thead>
                <tbody>
                <tr><td>12</td><td>135</td><td>60</td><td>205</td><td>90</td></tr>
                <tr><td>13</td><td>145</td><td>55</td><td>225</td><td>90</td></tr>
                <tr><td>14</td><td>145</td><td>50</td><td>265</td><td>90</td></tr>
                <tr><td>15</td><td>155</td><td>35</td><td>315</td><td>90</td></tr>
                <tr><td>16</td><td>165</td><td>35</td><td>315</td><td>85</td></tr>
                <tr><td>17</td><td>185</td><td>35</td><td>335</td><td>75</td></tr>
                <tr><td>18</td><td>205</td><td>30</td><td>345</td><td>70</td></tr>
                <tr><td>19</td><td>225</td><td>25</td><td>355</td><td>65</td></tr>
                <tr><td>20</td><td>225</td><td>25</td><td>355</td><td>65</td></tr>
                <tr><td>21</td><td>235</td><td>25</td><td>355</td><td>55</td></tr>
                <tr><td>22</td><td>235</td><td>25</td><td>355</td><td>55</td></tr>
                <tr><td>23</td><td>235</td><td>25</td><td>355</td><td>40</td></tr>
                <tr><td>24</td><td>245</td><td>20</td><td>355</td><td>40</td></tr>
                <tr><td>25</td><td>245</td><td>20</td><td>355</td><td>35</td></tr>
                </tbody>
            </table>
        </details>
    </div>

    <div class="input-group">
        <div class="input-item">
            <label for="diskDiameter">–î—ñ–∞–º–µ—Ç—Ä –¥–∏—Å–∫–∞ (R, –¥—é–π–º–∏)</label>
            <input type="number" id="diskDiameter" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, 14" min="1" required>
        </div>
        <div class="input-item">
            <label for="tireWidth">–®–∏—Ä–∏–Ω–∞ —à–∏–Ω–∏ (W, –º–º)</label>
            <input type="number" id="tireWidth" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, 285" min="100" step="5" required>
        </div>
        <div class="input-item">
            <label for="profileHeight">–ü—Ä–æ—Ñ—ñ–ª—å (V, %)</label>
            <input type="number" id="profileHeight" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, 45" min="20" step="5" required>
        </div>
    </div>
    <button onclick="calculateNewSizes()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –Ω–æ–≤—ñ —Ä–æ–∑–º—ñ—Ä–∏</button>
    <div id="error-message" class="error"></div>

    <div id="results-area" class="card-container" style="display:none;">
    </div>
</div>

<script>
  const INCH_TO_MM = 25.4;
  const MIN_PROFILE_GLOBAL = 20;
  const MIN_R = 12;
  const MAX_R = 25;
  const MAX_WIDTH_SEARCH_DELTA = 40;
  const WIDTH_STEP = 10;
  const MAX_DELTA_PERCENT = 2.0; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –¥–µ–ª—å—Ç–∞ 2%

  // –ú–Ü–ù–Ü–ú–ê–õ–¨–ù–Ü –õ–Ü–ú–Ü–¢–ò: [–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –®–∏—Ä–∏–Ω–∞, –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –ü—Ä–æ—Ñ—ñ–ª—å]
  const MIN_LIMITS = {
    12: [135, 60], 13: [145, 55], 14: [145, 50], 15: [155, 35],
    16: [165, 35], 17: [185, 35], 18: [205, 30], 19: [225, 25],
    20: [225, 25], 21: [235, 25], 22: [235, 25], 23: [235, 25],
    24: [245, 20], 25: [245, 20]
  };

  // –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–Ü –õ–Ü–ú–Ü–¢–ò: [–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –®–∏—Ä–∏–Ω–∞, –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –ü—Ä–æ—Ñ—ñ–ª—å]
  const MAX_LIMITS = {
    12: [205, 90], 13: [225, 90], 14: [265, 90], 15: [315, 90],
    16: [315, 85], 17: [335, 75], 18: [345, 70], 19: [355, 65],
    20: [355, 65], 21: [355, 55], 22: [355, 55], 23: [355, 40],
    24: [355, 40], 25: [355, 35]
  };

  /**
   * –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è R, W, V –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º —Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–º –ª—ñ–º—ñ—Ç–∞–º.
   */
  function checkAllLimits(R_new, W_new, V_new) {
    if (R_new < MIN_R || R_new > MAX_R || R_new % 1 !== 0) return false;

    const [minW, minV] = MIN_LIMITS[R_new];
    const [maxW, maxV] = MAX_LIMITS[R_new];

    return !(
      V_new < MIN_PROFILE_GLOBAL ||
      W_new < minW || V_new < minV ||
      W_new > maxW || V_new > maxV
    );
  }


  function calculateTotalDiameter(D_inch, W_mm, V_percent) {
    const D_mm = D_inch * INCH_TO_MM;
    const H_mm = W_mm * (V_percent / 100);
    return D_mm + (2 * H_mm);
  }

  // –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –æ–¥–Ω–æ–≥–æ –≤–∞—Ä—ñ–∞–Ω—Ç–∞ –ø—Ä–æ—Ñ—ñ–ª—é
  function calculateSingleProfileOption(R_new, W_new, V_new, D_total_old) {
    const D_total_new = calculateTotalDiameter(R_new, W_new, V_new);
    const delta = D_total_new - D_total_old;
    const delta_percent = (delta / D_total_old) * 100;
    const newSize = `${W_new}/${V_new} R${R_new}`;

    // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –¥–µ–ª—å—Ç—É
    if (Math.abs(delta_percent) > MAX_DELTA_PERCENT) {
      return null;
    }

    return { W_new, R_new, V_new, D_total_new, delta, delta_percent, newSize };
  }


  /**
   * –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –∫—Ä–∞—â–∏–π –ø—Ä–æ—Ñ—ñ–ª—å (V) —ñ–∑ –¥–≤–æ—Ö –Ω–∞–π–±–ª–∏–∂—á–∏—Ö –∫—Ä–∞—Ç–Ω–∏—Ö 5% —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ª—ñ–º—ñ—Ç–∏.
   */
  function calculateOption(W_new, D_total_old, R_new) {

    const D_disk_mm_new = R_new * INCH_TO_MM;
    const H_needed = (D_total_old - D_disk_mm_new) / 2;

    if (H_needed <= 0) return null;

    const V_needed_float = (H_needed / W_new) * 100;

    const step = 5;
    let V_A = Math.max(MIN_PROFILE_GLOBAL, Math.floor(V_needed_float / step) * step);
    let V_B = Math.max(MIN_PROFILE_GLOBAL, Math.ceil(V_needed_float / step) * step);

    let bestResult = null;

    // 1. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—ñ–∞–Ω—Ç–∞ –ê —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª—ñ–º—ñ—Ç—ñ–≤
    const passesLimitsA = checkAllLimits(R_new, W_new, V_A);
    const result_A = calculateSingleProfileOption(R_new, W_new, V_A, D_total_old); // null —è–∫—â–æ delta > 2%

    // 2. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—ñ–∞–Ω—Ç–∞ B —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª—ñ–º—ñ—Ç—ñ–≤
    let result_B = null;
    const passesLimitsB = checkAllLimits(R_new, W_new, V_B);

    if (V_A !== V_B) {
      result_B = calculateSingleProfileOption(R_new, W_new, V_B, D_total_old); // null —è–∫—â–æ delta > 2%
    }

    const finalResults = [];

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç A –ª—ñ–º—ñ—Ç–∏ (R/W/V) —Ç–∞ –ª—ñ–º—ñ—Ç –¥–µ–ª—å—Ç–∏
    if (passesLimitsA && result_A) finalResults.push(result_A);
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç B –ª—ñ–º—ñ—Ç–∏ (R/W/V) —Ç–∞ –ª—ñ–º—ñ—Ç –¥–µ–ª—å—Ç–∏
    if (V_A !== V_B && passesLimitsB && result_B) finalResults.push(result_B);

    if (finalResults.length === 0) return null;

    // –í–∏–±—ñ—Ä –∫—Ä–∞—â–æ–≥–æ –∑ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
    if (finalResults.length === 1) {
      bestResult = finalResults[0];
    } else {
      // –í–∏–±—ñ—Ä –º–µ–Ω—à–æ—ó –¥–µ–ª—å—Ç–∏
      if (Math.abs(finalResults[0].delta) <= Math.abs(finalResults[1].delta)) {
        bestResult = finalResults[0];
      } else {
        bestResult = finalResults[1];
      }
    }

    bestResult && (bestResult.V_needed_float = V_needed_float);

    return bestResult;
  }


  /**
   * –î–ª—è –∑–∞–¥–∞–Ω–æ—ó —à–∏—Ä–∏–Ω–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–∞–π–±—ñ–ª—å—à–∏–π R (–≤—ñ–¥ MAX_R –¥–æ MIN_R),
   * —è–∫–∏–π –º–∞—î –Ω–∞–π–∫—Ä–∞—â—É (–º—ñ–Ω—ñ–º–∞–ª—å–Ω—É) –¥–µ–ª—å—Ç—É –°–ï–†–ï–î –£–°–Ü–• –î–û–ü–£–°–¢–ò–ú–ò–• –í–ê–†–Ü–ê–ù–¢–Ü–í R.
   */
  function findBestOptionForWidth(W_new, D_total_old) {
    let bestWOption = null;
    let bestWDeltaAbs = Infinity;
    let bestWOptionR = MIN_R - 1;

    // 1. –Ü—Ç–µ—Ä—É—î–º–æ R –≤—ñ–¥ –Ω–∞–π–±—ñ–ª—å—à–æ–≥–æ –¥–æ –Ω–∞–π–º–µ–Ω—à–æ–≥–æ, —â–æ–± –ø—Ä—ñ–æ—Ä–∏—Ç–µ–∑—É–≤–∞—Ç–∏ R
    for (let R = MAX_R; R >= MIN_R; R--) {
      const result = calculateOption(W_new, D_total_old, R);

      if (result) {
        const currentDeltaAbs = Math.abs(result.delta);

        // 1. –Ø–∫—â–æ R –±—ñ–ª—å—à–∏–π –∑–∞ –ø–æ—Ç–æ—á–Ω–∏–π –Ω–∞–π–∫—Ä–∞—â–∏–π R, –º–∏ –π–æ–≥–æ –ø—Ä–∏–π–º–∞—î–º–æ
        if (R > bestWOptionR) {
          bestWDeltaAbs = currentDeltaAbs;
          bestWOption = result;
          bestWOptionR = R;
        }
        // 2. –Ø–∫—â–æ R –æ–¥–Ω–∞–∫–æ–≤–∏–π, –∞–ª–µ –ø–æ—Ç–æ—á–Ω–∞ –¥–µ–ª—å—Ç–∞ –∫—Ä–∞—â–∞, –ø—Ä–∏–π–º–∞—î–º–æ
        else if (R === bestWOptionR && currentDeltaAbs < bestWDeltaAbs) {
          bestWDeltaAbs = currentDeltaAbs;
          bestWOption = result;
        }
      }
    }
    return bestWOption;
  }


  function calculateNewSizes() {
    const R_old_str = document.getElementById('diskDiameter').value;
    const W_old_str = document.getElementById('tireWidth').value;
    const V_old_str = document.getElementById('profileHeight').value;

    if (!R_old_str || !W_old_str || !V_old_str) {
      document.getElementById('error-message').textContent = '–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è.';
      document.getElementById('results-area').style.display = 'none';
      return;
    }

    const R_old = parseFloat(R_old_str);
    const W_old = parseFloat(W_old_str);
    const V_old = parseFloat(V_old_str);

    const errorDiv = document.getElementById('error-message');
    errorDiv.textContent = '';
    const resultsArea = document.getElementById('results-area');
    resultsArea.style.display = 'none';
    resultsArea.innerHTML = '';


    if (isNaN(R_old) || isNaN(W_old) || isNaN(V_old) || V_old < 20 || W_old % 5 !== 0 || V_old % 5 !== 0) {
      errorDiv.textContent = '–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ. –®–∏—Ä–∏–Ω–∞ —ñ –ø—Ä–æ—Ñ—ñ–ª—å –º–∞—é—Ç—å –±—É—Ç–∏ –∫—Ä–∞—Ç–Ω—ñ 5. –ü—Ä–æ—Ñ—ñ–ª—å –Ω–µ –º–µ–Ω—à–µ 20.';
      return;
    }

    const D_total_old = calculateTotalDiameter(R_old, W_old, V_old);
    const INITIAL_SIZE_KEY = `${W_old}/${V_old} R${R_old}`;

    let bestMainResult = null;
    let bestMainDeltaAbs = Infinity;

    let resultsMain = [];

    // --- 1. –û–±—á–∏—Å–ª–µ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥—ñ–∞–ø–∞–∑–æ–Ω—É (W, W+10, W+20) ---
    const mainWidths = [W_old, W_old + WIDTH_STEP, W_old + 2 * WIDTH_STEP];

    mainWidths.forEach(W => {
      const bestOptionForW = findBestOptionForWidth(W, D_total_old);

      if (bestOptionForW) {
        // –í–∏–∫–ª—é—á–∞—î–º–æ –≤–∏—Ö—ñ–¥–Ω–∏–π —Ä–æ–∑–º—ñ—Ä, —è–∫—â–æ —Ü–µ –Ω–µ –≤–∏—Ö—ñ–¥–Ω–∏–π R
        if (bestOptionForW.newSize !== INITIAL_SIZE_KEY) {
          resultsMain.push(bestOptionForW);
        }

        // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–π–∫—Ä–∞—â–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ
        if (Math.abs(bestOptionForW.delta) < bestMainDeltaAbs) {
          bestMainDeltaAbs = Math.abs(bestOptionForW.delta);
          bestMainResult = bestOptionForW;
        }
      }
    });

    // --- 2. –Ü—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∏–π –ø–æ—à—É–∫ –Ω–∞–π–∫—Ä–∞—â–æ—ó –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ (W < W –∞–±–æ W > W+20) - –ö–†–û–ö 10 –ú–ú ---

    let bestAlternativeResult = null;
    let altWidths = [];
    for (let W = W_old + 3 * WIDTH_STEP; W <= W_old + MAX_WIDTH_SEARCH_DELTA; W += WIDTH_STEP) altWidths.push(W);
    for (let W = W_old - WIDTH_STEP; W >= W_old - MAX_WIDTH_SEARCH_DELTA && W >= 100; W -= WIDTH_STEP) altWidths.push(W);

    altWidths.forEach(W => {
      const bestOptionForW = findBestOptionForWidth(W, D_total_old);

      if (bestOptionForW) {
        if (Math.abs(bestOptionForW.delta) < bestMainDeltaAbs) {
          bestMainDeltaAbs = Math.abs(bestOptionForW.delta);
          bestAlternativeResult = bestOptionForW;
        }
      }
    });

    // --- 3. –ì–µ–Ω–µ—Ä—É—î–º–æ –∫–∞—Ä—Ç–∫–∏ ---

    if (resultsMain.length === 0 && !bestAlternativeResult) {
      errorDiv.textContent = '–ù–µ–º–æ–∂–ª–∏–≤–æ –∑–Ω–∞–π—Ç–∏ –∂–æ–¥–Ω–æ–≥–æ –≤–∞—Ä—ñ–∞–Ω—Ç–∞, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤—Å—ñ–º –∫—Ä–∏—Ç–µ—Ä—ñ—è–º, –≤–∫–ª—é—á–∞—é—á–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–µ–ª—å—Ç–∏ 2%.';
      return;
    }

    // –ö–∞—Ä—Ç–∫–∞ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É
    let initialCardHTML = `
            <div class="result-card card-initial">
                <div class="card-title" style="color:#000;">–ü–æ—Ç–æ—á–Ω–∏–π —Ä–æ–∑–º—ñ—Ä</div>
                <div class="card-body">
                    <p><span>–†–æ–∑–º—ñ—Ä:</span> <span class="big-size" style="color:#000;">${W_old}/${V_old} R${R_old}</span></p>
                    <p><span>–î—ñ–∞–º–µ—Ç—Ä:</span> ${D_total_old.toFixed(1)} –º–º</p>
                    <p><span>–®–∏—Ä–∏–Ω–∞ (W):</span> ${W_old} –º–º</p>
                    <p><span>–ü—Ä–æ—Ñ—ñ–ª—å (V):</span> ${V_old}%</p>
                </div>
            </div>
        `;
    resultsArea.innerHTML += initialCardHTML;


    // –ö–∞—Ä—Ç–∫–∏ –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
    resultsMain.forEach(r => {
      // –í–∏–¥—ñ–ª—è—î–º–æ –∑–µ–ª–µ–Ω–∏–º —Ä–∞–º–∫–æ—é –Ω–∞–π–∫—Ä–∞—â–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç —É *–æ—Å–Ω–æ–≤–Ω–æ–º—É –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ*
      const isBestInMain = bestMainResult && r.newSize === bestMainResult.newSize;

      const deltaClass = Math.abs(r.delta_percent) < MAX_DELTA_PERCENT ? 'delta-good' : 'delta-warn';
      const cardClass = isBestInMain ? 'best-option-card' : '';
      const widthDelta = r.W_new - W_old;

      let cardHTML = `
                <div class="result-card ${cardClass}">
                    <div class="card-title">–í–∞—Ä—ñ–∞–Ω—Ç W+${widthDelta} (${r.W_new} –º–º)</div>
                    <div class="card-body">
                        <p><span><strong>–ù–û–í–ò–ô –†–û–ó–ú–Ü–†:</strong></span> <span class="big-size">${r.newSize}</span></p>
                        <p><span>–ó–±—ñ–ª—å—à–µ–Ω–Ω—è —à–∏—Ä–∏–Ω–∏:</span> ${widthDelta} –º–º</p>
                        <p><span>–ú–∞–∫—Å. –¥–∏—Å–∫ (R):</span> ${r.R_new} –¥—é–π–º—ñ–≤</p>
                        <p><span>–§–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å:</span> ${r.V_new}% (–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∏–π: ${r.V_needed_float.toFixed(2)}%)</p>
                        <p><span>–§—ñ–Ω–∞–ª—å–Ω–∏–π –¥—ñ–∞–º–µ—Ç—Ä:</span> ${r.D_total_new.toFixed(1)} –º–º</p>
                        <p><span>–î–µ–ª—å—Ç–∞ –¥—ñ–∞–º–µ—Ç—Ä–∞:</span> ${r.delta.toFixed(1)} –º–º (<span class="${deltaClass}">${r.delta_percent.toFixed(2)}%</span>)</p>
                    </div>
                </div>
            `;
      resultsArea.innerHTML += cardHTML;
    });

    // –ö–∞—Ä—Ç–∫–∞ –Ω–∞–π–∫—Ä–∞—â–æ–≥–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –≤–∞—Ä—ñ–∞–Ω—Ç—É (—è–∫—â–æ –≤—ñ–Ω –∫—Ä–∞—â–∏–π)
    if (bestAlternativeResult) {
      const r = bestAlternativeResult;
      const deltaClass = Math.abs(r.delta_percent) < MAX_DELTA_PERCENT ? 'delta-good' : 'delta-warn';
      const cardClass = 'alternative-option-card';
      const widthDelta = r.W_new - W_old;

      let altCardHTML = `
                <div class="result-card ${cardClass}">
                    <div class="card-title"><strong>–ê–ë–°–û–õ–Æ–¢–ù–û –ù–ê–ô–ö–†–ê–©–ê –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê</strong> W+${widthDelta} (${r.W_new} –º–º)</div>
                    <div class="card-body">
                        <p><span><strong>–ù–û–í–ò–ô –†–û–ó–ú–Ü–†:</strong></span> <span class="big-size">${r.newSize}</span></p>
                        <p><span>–ó–±—ñ–ª—å—à–µ–Ω–Ω—è/–ó–º–µ–Ω—à–µ–Ω–Ω—è —à–∏—Ä–∏–Ω–∏:</span> ${widthDelta} –º–º</p>
                        <p><span>–ú–∞–∫—Å. –¥–∏—Å–∫ (R):</span> ${r.R_new} –¥—é–π–º—ñ–≤</p>
                        <p><span>–§–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å:</span> ${r.V_new}% (–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∏–π: ${r.V_needed_float.toFixed(2)}%)</p>
                        <p><span>–§—ñ–Ω–∞–ª—å–Ω–∏–π –¥—ñ–∞–º–µ—Ç—Ä:</span> ${r.D_total_new.toFixed(1)} –º–º</p>
                        <p><span>–î–µ–ª—å—Ç–∞ –¥—ñ–∞–º–µ—Ç—Ä–∞:</span> ${r.delta.toFixed(1)} –º–º (<span class="${deltaClass}">${r.delta_percent.toFixed(2)}%</span>)</p>
                    </div>
                </div>
            `;
      resultsArea.innerHTML += altCardHTML;
    }

    resultsArea.style.display = 'flex';
  }
</script>

</body>
</html>